local WindUI = loadstring(game:HttpGet("https://pastebin.com/raw/m8P8dLfd"))()

WindUI:AddTheme(
    {
        Name = "Peach Glow Dominant",
        Accent = Color3.fromHex("#474350"),
        Background = Color3.fromHex("#FFFFFF"),
        BackgroundTransparency = 0,
        Outline = Color3.fromHex("#474350"),
        Text = Color3.fromHex("#474350"),
        Placeholder = Color3.fromHex("#474350"),
        Button = Color3.fromHex("#474350"),
        Icon = Color3.fromHex("#474350"),
        Hover = Color3.fromHex("#fafac6"),
        WindowBackground = Color3.fromHex("#FECDAA"),
        WindowShadow = Color3.fromHex("#000000"),
        WindowTopbarTitle = Color3.fromHex("#474350"),
        WindowTopbarAuthor = Color3.fromHex("#474350"),
        WindowTopbarIcon = Color3.fromHex("#474350"),
        WindowTopbarButtonIcon = Color3.fromHex("#474350"),
        TabBackground = Color3.fromHex("#FFFFFF"),
        TabTitle = Color3.fromHex("#474350"),
        TabIcon = Color3.fromHex("#474350"),
        ElementBackground = Color3.fromHex("#f8fff4"),
        ElementTitle = Color3.fromHex("#474350"),
        ElementDesc = Color3.fromHex("#474350"),
        ElementIcon = Color3.fromHex("#474350"),
        PopupBackground = Color3.fromHex("#fcffeb"),
        PopupBackgroundTransparency = 0,
        PopupTitle = Color3.fromHex("#474350"),
        PopupContent = Color3.fromHex("#474350"),
        PopupIcon = Color3.fromHex("#474350"),
        DialogBackground = Color3.fromHex("#fcffeb"),
        DialogBackgroundTransparency = 0,
        DialogTitle = Color3.fromHex("#474350"),
        DialogContent = Color3.fromHex("#474350"),
        DialogIcon = Color3.fromHex("#474350"),
        Toggle = Color3.fromHex("#474350"),
        ToggleBar = Color3.fromHex("#fafac6"),
        Checkbox = Color3.fromHex("#474350"),
        CheckboxIcon = Color3.fromHex("#fafac6"),
        Slider = Color3.fromHex("#474350"),
        SliderThumb = Color3.fromHex("#fafac6")
    }
)

WindUI:AddTheme(
    {
        Name = "Material Nature Light",
        Accent = Color3.fromHex("#4C662B"),
        Background = Color3.fromHex("#F9FAEF"),
        BackgroundTransparency = 0,
        Outline = Color3.fromHex("#75796C"),
        Text = Color3.fromHex("#1A1C16"),
        Placeholder = Color3.fromHex("#44483D"),
        Button = Color3.fromHex("#CDEDA3"),
        Icon = Color3.fromHex("#44483D"),
        Hover = Color3.fromHex("#E1E4D5"),
        WindowBackground = Color3.fromHex("#F9FAEF"),
        WindowShadow = Color3.fromHex("#000000"),
        WindowTopbarTitle = Color3.fromHex("#1A1C16"),
        WindowTopbarAuthor = Color3.fromHex("#44483D"),
        WindowTopbarIcon = Color3.fromHex("#44483D"),
        WindowTopbarButtonIcon = Color3.fromHex("#44483D"),
        TabBackground = Color3.fromHex("#F9FAEF"),
        TabTitle = Color3.fromHex("#1A1C16"),
        TabIcon = Color3.fromHex("#44483D"),
        ElementBackground = Color3.fromHex("#EEEFE3"),
        ElementTitle = Color3.fromHex("#1A1C16"),
        ElementDesc = Color3.fromHex("#44483D"),
        ElementIcon = Color3.fromHex("#44483D"),
        PopupBackground = Color3.fromHex("#EEEFE3"),
        PopupBackgroundTransparency = 0,
        PopupTitle = Color3.fromHex("#1A1C16"),
        PopupContent = Color3.fromHex("#44483D"),
        PopupIcon = Color3.fromHex("#44483D"),
        DialogBackground = Color3.fromHex("#EEEFE3"),
        DialogBackgroundTransparency = 0,
        DialogTitle = Color3.fromHex("#1A1C16"),
        DialogContent = Color3.fromHex("#44483D"),
        DialogIcon = Color3.fromHex("#44483D"),
        Toggle = Color3.fromHex("#4C662B"),
        ToggleBar = Color3.fromHex("#FFFFFF"),
        Checkbox = Color3.fromHex("#4C662B"),
        CheckboxIcon = Color3.fromHex("#FFFFFF"),
        Slider = Color3.fromHex("#4C662B"),
        SliderThumb = Color3.fromHex("#FFFFFF")
    }
)

WindUI:AddTheme(
    {
        Name = "Material Nature Dark",
        Accent = Color3.fromHex("#B1D18A"),
        Background = Color3.fromHex("#12140E"),
        BackgroundTransparency = 0,
        Outline = Color3.fromHex("#8F9285"),
        Text = Color3.fromHex("#E2E3D8"),
        Placeholder = Color3.fromHex("#C5C8BA"),
        Button = Color3.fromHex("#354E16"),
        Icon = Color3.fromHex("#C5C8BA"),
        Hover = Color3.fromHex("#44483D"),
        WindowBackground = Color3.fromHex("#12140E"),
        WindowShadow = Color3.fromHex("#000000"),
        WindowTopbarTitle = Color3.fromHex("#E2E3D8"),
        WindowTopbarAuthor = Color3.fromHex("#C5C8BA"),
        WindowTopbarIcon = Color3.fromHex("#C5C8BA"),
        WindowTopbarButtonIcon = Color3.fromHex("#C5C8BA"),
        TabBackground = Color3.fromHex("#12140E"),
        TabTitle = Color3.fromHex("#E2E3D8"),
        TabIcon = Color3.fromHex("#C5C8BA"),
        ElementBackground = Color3.fromHex("#1E201A"),
        ElementTitle = Color3.fromHex("#E2E3D8"),
        ElementDesc = Color3.fromHex("#C5C8BA"),
        ElementIcon = Color3.fromHex("#C5C8BA"),
        PopupBackground = Color3.fromHex("#1E201A"),
        PopupBackgroundTransparency = 0,
        PopupTitle = Color3.fromHex("#E2E3D8"),
        PopupContent = Color3.fromHex("#C5C8BA"),
        PopupIcon = Color3.fromHex("#C5C8BA"),
        DialogBackground = Color3.fromHex("#1E201A"),
        DialogBackgroundTransparency = 0,
        DialogTitle = Color3.fromHex("#E2E3D8"),
        DialogContent = Color3.fromHex("#C5C8BA"),
        DialogIcon = Color3.fromHex("#C5C8BA"),
        Toggle = Color3.fromHex("#B1D18A"),
        ToggleBar = Color3.fromHex("#1F3701"),
        Checkbox = Color3.fromHex("#B1D18A"),
        CheckboxIcon = Color3.fromHex("#1F3701"),
        Slider = Color3.fromHex("#B1D18A"),
        SliderThumb = Color3.fromHex("#FFFFFF")
    }
)

WindUI:AddTheme(
    {
        Name = "Pacific Dark",
        Accent = Color3.fromHex("#58a4b0"),
        Background = Color3.fromHex("#2b303a"),
        BackgroundTransparency = 0,
        Outline = Color3.fromHex("#bac1b8"),
        Text = Color3.fromHex("#bac1b8"),
        Placeholder = Color3.fromHex("#bac1b8"),
        Button = Color3.fromHex("#0c7c59"),
        Icon = Color3.fromHex("#bac1b8"),
        Hover = Color3.fromHex("#d64933"),
        WindowBackground = Color3.fromHex("#2b303a"),
        WindowShadow = Color3.fromHex("#000000"),
        WindowTopbarTitle = Color3.fromHex("#bac1b8"),
        WindowTopbarAuthor = Color3.fromHex("#bac1b8"),
        WindowTopbarIcon = Color3.fromHex("#bac1b8"),
        WindowTopbarButtonIcon = Color3.fromHex("#bac1b8"),
        TabBackground = Color3.fromHex("#2b303a"),
        TabTitle = Color3.fromHex("#bac1b8"),
        TabIcon = Color3.fromHex("#bac1b8"),
        ElementBackground = Color3.fromHex("#2b303a"),
        ElementTitle = Color3.fromHex("#bac1b8"),
        ElementDesc = Color3.fromHex("#bac1b8"),
        ElementIcon = Color3.fromHex("#bac1b8"),
        PopupBackground = Color3.fromHex("#2b303a"),
        PopupBackgroundTransparency = 0,
        PopupTitle = Color3.fromHex("#bac1b8"),
        PopupContent = Color3.fromHex("#bac1b8"),
        PopupIcon = Color3.fromHex("#bac1b8"),
        DialogBackground = Color3.fromHex("#2b303a"),
        DialogBackgroundTransparency = 0,
        DialogTitle = Color3.fromHex("#bac1b8"),
        DialogContent = Color3.fromHex("#bac1b8"),
        DialogIcon = Color3.fromHex("#bac1b8"),
        Toggle = Color3.fromHex("#58a4b0"),
        ToggleBar = Color3.fromHex("#bac1b8"),
        Checkbox = Color3.fromHex("#58a4b0"),
        CheckboxIcon = Color3.fromHex("#2b303a"),
        Slider = Color3.fromHex("#58a4b0"),
        SliderThumb = Color3.fromHex("#d64933")
    }
)

local Window =
    WindUI:CreateWindow(
        {
            Title = "Catch and Tame: AUTO FARM",
            Icon = "door-open",
            Author = "JumantaraHub v2.3",
            Theme = "Plant",
            Folder = "CatchandTame_JumantaraHub",
            KeySystem = {
                Note = "Key System. With platoboost.",
                API = {
                    {                                                    -- PlatoBoost
                        Type = "platoboost",
                        ServiceId = 16361,                               -- service id
                        Secret = "4485a80f-25df-4788-b082-5d3f19a932ac", -- platoboost secret
                    },
                },
            },
        }
    )

Window:EditOpenButton(
    {
        Title = "Open UI",
        Icon = "monitor",
        CornerRadius = UDim.new(0, 16),
        StrokeThickness = 2,
        Color = ColorSequence.new(Color3.fromHex("FF0F7B"), Color3.fromHex("F89B29")),
        OnlyMobile = false,
        Enabled = true,
        Draggable = true
    }
)

Window:Tag({
    Title = "Auto Everything",
    Icon = "rss",
    Color = Color3.fromHex("#30ff6a"),
    Radius = 0,
})

local Tab =
    Window:Tab(
        {
            Title = "Main",
            Icon = "bird",
            Locked = false
        }
    )

local CollectTab =
    Window:Tab(
        {
            Title = "Auto Collect",
            Icon = "bird",
            Locked = false
        }
    )
local BreedTab = Window:Tab({
    Title = "Breeding & Eggs",
    Icon = "bird",
    Locked = false
})
local PickupTab = Window:Tab({
    Title = "Auto Pickup",
    Icon = "bird",
    Locked = false
})
local SellTab =
    Window:Tab(
        {
            Title = "Auto Sell",
            Icon = "bird",
            Locked = false
        }
    )

local BuyTab =
    Window:Tab(
        {
            Title = "Auto Buy Food",
            Icon = "bird",
            Locked = false
        }
    )

local FeedTab =
    Window:Tab(
        {
            Title = "Auto Feed",
            Icon = "bird",
            Locked = false
        }
    )

local SettingTab =
    Window:Tab(
        {
            Title = "Settings",
            Icon = "bird",
            Locked = false
        }
    )

getgenv().SelectRarity = "Legendary"
getgenv().TargetCatchRarities = {}

getgenv().MutationOnly = false

getgenv().AutoCatchEnabled = true

getgenv().DebugMode = false

getgenv().AutoCollectCash = false
getgenv().AntiAfk = true
getgenv().AutoSell = false
getgenv().AutoBreed = false
getgenv().AutoPickupEgg = false
getgenv().BreedParent1 = nil
getgenv().BreedParent2 = nil
getgenv().SelectedBreedRarities = {}
getgenv().EggAction = "Pickup" -- Default action
getgenv().EnableEggManager = false
getgenv().SellConfig = {
    ["Common"] = false,
    ["Uncommon"] = false,
    ["Rare"] = false,
    ["Epic"] = false,
    ["Legendary"] = false,
    ["Mythical"] = false
}
getgenv().AutoPickupPets = false
getgenv().PickupPetRarities = {} -- Menyimpan Rarity yang dipilih
getgenv().AutoCollectFruits = false
getgenv().AutoPickupEggs = false
getgenv().PickupEggNames = {} -- Menyimpan Nama Egg yang dipilih
getgenv().AutoBuyFood = false

getgenv().SelectedFoodList = {}

getgenv().BuyAmount = 1

getgenv().AutoFeed = false

getgenv().SelectedFeedFood = "Steak"

getgenv().TargetPetUUID = nil
getgenv().SelectedRecipe = nil
getgenv().AutoBreedRecipe = false
getgenv().AutoBreedAllRecipes = false
getgenv().AutoFeedAll = false
getgenv().FoodsToFeed = {}
getgenv().AutoFeedAllFoods = false
getgenv().AutoPlace = false
getgenv().PetsToPlaceList = {}
getgenv().SellEggConfig = {}
getgenv().SellConfig = {}
getgenv().IgnoredPets = {}


local rarityList = { "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical", "Exclusive", "Secret" }
local RarityWeights = {
    ["Common"] = 1,
    ["Uncommon"] = 2,
    ["Rare"] = 3,
    ["Epic"] = 4,
    ["Legendary"] = 5,
    ["Mythical"] = 6,
    ["Exclusive"] = 7,
    ["Secret"] = 8
}
local eggNamesList = {}
for _, rarity in ipairs(rarityList) do
    table.insert(eggNamesList, rarity .. " Egg")
end
local BreedRecipes = require(game:GetService("ReplicatedStorage").Configs.Breeding.breedRecipes)
local Remotes = game:GetService("ReplicatedStorage"):WaitForChild("Remotes")

local Players = game:GetService("Players")

local LocalPlayer = Players.LocalPlayer

local foodList = {
    "Farmers Feed",
    "Enriched Feed",
    "Prime Feed",
    "Hay",
    "Bone",
    "Steak"
}

local petMap = {}
local function GetMyPen()
    local p = game.Players.LocalPlayer

    local pensFolder = workspace:FindFirstChild("PlayerPens")

    if pensFolder then
        for _, pen in pairs(pensFolder:GetChildren()) do
            if pen:GetAttribute("Owner") == p.Name then
                return pen
            end
        end
    end

    return nil
end
local function EquipLasso()
    local backpack = LocalPlayer:FindFirstChild("Backpack")

    local char = LocalPlayer.Character

    if backpack and char then
        local tool = backpack:FindFirstChild("Lasso") or backpack:FindFirstChildWhichIsA("Tool")

        if tool and not char:FindFirstChild(tool.Name) then
            char.Humanoid:EquipTool(tool)

            task.wait(0.3)
        end
    end
end

local function RunCatchProtocol(targetPet)
    if not targetPet or not targetPet.Parent then
        return
    end

    local char = LocalPlayer.Character

    if not char then
        return
    end

    local root = char:FindFirstChild("HumanoidRootPart")

    EquipLasso()

    local petPivot = targetPet:GetPivot()

    local direction = (petPivot.Position - root.Position).Unit

    local distance = (petPivot.Position - root.Position).Magnitude

    if distance > 20 then
        WindUI:Notify({ Title = "Failed", Content = "Server distance too far, try again.", Duration = 2 })

        return
    end

    pcall(
        function()
            Remotes.ThrowLasso:FireServer(0.9, direction)
        end
    )

    task.wait(0.5)

    local success, err =
        pcall(
            function()
                Remotes.minigameRequest:InvokeServer(targetPet, root.CFrame)
            end
        )

    if not success then
        return
    end

    task.wait(0.2)

    pcall(
        function()
            Remotes.equipLassoVisual:InvokeServer(true)
        end
    )

    local progressSteps = { 0, 30, 60, 90, 100 }

    for _, prog in ipairs(progressSteps) do
        Remotes.UpdateProgress:FireServer(prog)

        task.wait(0.15)
    end

    pcall(
        function()
            Remotes.retrieveData:InvokeServer()
        end
    )
end

local function GetInventoryData()
    local RS = game:GetService("ReplicatedStorage")
    local success, result = pcall(function()
        return RS.Remotes.getPetInventory:InvokeServer()
    end)
    if success then return result else return {} end
end
local function GetEggInventoryData()
    local RS = game:GetService("ReplicatedStorage")
    local success, result = pcall(function()
        return RS.Remotes.getEggInventory:InvokeServer()
    end)
    if success then return result else return {} end
end
-- Coba ambil config pet dari game
local PetConfig = nil
local success, result = pcall(function()
    -- Sesuaikan path ini dengan lokasi asli ModuleScript yang kamu decompile tadi
    -- Biasanya ada di ReplicatedStorage > Configs > Pets atau similar
    return require(game:GetService("ReplicatedStorage").Configs.Pets)
end)

if success then
    PetConfig = result
else
    -- Fallback jika gagal load (bisa isi manual atau kosongkan)
    PetConfig = {}
    warn("Gagal load Pet Config, fitur filter nama mungkin kosong.")
end

local function GetAllPetNames()
    local names = {}
    if PetConfig then
        for name, _ in pairs(PetConfig) do
            -- Kita masukkan semua nama ke list
            table.insert(names, name)
        end
    end
    table.sort(names) -- Urutkan abjad biar rapi
    return names
end

local fullPetNameList = GetAllPetNames()
-- Variabel forward declaration untuk Dropdown (agar bisa di-refresh dari dalam fungsi)
local PlaceDropdown = nil

local function ExecutePlacePets()
    local myPen = GetMyPen()
    local inv = GetInventoryData()

    if myPen and inv then
        local penPos = myPen:GetPivot().Position
        local count = 0

        -- Loop semua pet yang DIPILIH user
        for _, uuid in pairs(getgenv().PetsToPlaceList) do
            -- Validasi: Pastikan pet masih ada di inventory & belum placed
            if inv[uuid] and not inv[uuid].placed then
                local offset = Vector3.new(math.random(-15, 15), 5, math.random(-15, 15))

                -- Cek Grip (Posisi pegang) dari tool
                local tool = game.Players.LocalPlayer.Backpack:FindFirstChild(uuid)
                local grip = tool and tool:GetAttribute("Grip") or CFrame.new()

                -- Fire Remote
                game:GetService("ReplicatedStorage").Remotes.RequestPlacePet:FireServer(uuid, penPos + offset, grip)
                count = count + 1
                task.wait(0.1) -- Jeda dikit biar server memproses
            end
        end

        if count > 0 then
            WindUI:Notify({ Title = "Success", Content = "Placed " .. count .. " pets!", Duration = 3 })
        else
            WindUI:Notify({ Title = "Info", Content = "No valid pets placed (Maybe already placed?)", Duration = 2 })
        end

        -- === AUTO REFRESH LOGIC ===
        -- Kosongkan pilihan user agar tidak nyangkut
        getgenv().PetsToPlaceList = {}

        -- Update isi dropdown dengan data terbaru
        if PlaceDropdown then
            local newList, newMap = GetPlaceablePetsList()
            placeableMap = newMap          -- Update mapping global
            PlaceDropdown:Refresh(newList) -- Refresh visual UI
            -- Deselect visual di library (jika didukung) atau set value ke kosong
            -- WindUI biasanya mereset value visual saat Refresh dipanggil dengan list baru
        end
    end
end

-- Fungsi untuk mengambil list pet di inventory untuk Dropdown
-- Format: "NamaPet [Rarity] - UUID"
local function GetPlaceablePetsList()
    local list = {}
    local rawMap = {} -- UUID map

    local inventory = GetInventoryData()
    if inventory then
        for uuid, data in pairs(inventory) do
            if not data.placed then
                local displayName = data.name ..
                    " [" .. (data.rarity or "?") .. "] | " .. (data.mutation or "?")
                table.insert(list, displayName)
                rawMap[displayName] = uuid
            end
        end
    end

    table.sort(list)
    return list, rawMap
end

local placeableMap = {}
local function GetFormattedRecipes()
    local list = {}
    local rawMap = {} -- Menyimpan data asli untuk dipakai logic nanti

    for poolName, data in pairs(BreedRecipes) do
        if data.Parent1 and data.Parent2 and data.Data and data.Data.BreedSpecific then
            -- Ambil nama telur hasil (Result)
            local resultEggName = "Unknown"
            for eggName, chance in pairs(data.Data.BreedSpecific) do
                resultEggName = eggName
                break -- Ambil satu saja sebagai display
            end

            local displayName = data.Parent1 .. " + " .. data.Parent2 .. " -> " .. resultEggName
            table.insert(list, displayName)

            -- Simpan mapping agar saat user pilih nama, kita tahu data aslinya
            rawMap[displayName] = {
                P1 = data.Parent1,
                P2 = data.Parent2
            }
        end
    end

    table.sort(list) -- Urutkan abjad biar rapi
    return list, rawMap
end

-- Inisialisasi list resep
local recipeList, recipeMap = GetFormattedRecipes()

local function StartCandyFarm()
    task.spawn(
        function()
            while getgenv().AutoFarmCandy do
                local folder = workspace:FindFirstChild("RoamingPets") and workspace.RoamingPets:FindFirstChild("Pets")

                local foundTarget = false

                if folder then
                    for _, pet in pairs(folder:GetChildren()) do
                        if not getgenv().AutoFarmCandy then
                            break
                        end

                        local isCandyPet = pet:GetAttribute("CandyMax")

                        if isCandyPet and (pet:IsA("Model") or pet:IsA("BasePart")) then
                            foundTarget = true

                            local p = game.Players.LocalPlayer

                            if p and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                                p.Character.HumanoidRootPart.CFrame = pet:GetPivot()

                                task.wait(0.5)

                                RunCatchProtocol(pet)

                                task.wait(4)
                            end
                        end
                    end
                end

                if not foundTarget and getgenv().AutoFarmCandy then
                    WindUI:Notify({ Title = "Waiting for Spawn", Content = "Searching for Candy Pet...", Duration = 1 })

                    task.wait(3)
                end

                task.wait(0.5)
            end
        end
    )
end

local function StartRarityFarm()
    task.spawn(function()
        while getgenv().AutoFarmRarity do
            local folder = workspace:FindFirstChild("RoamingPets") and workspace.RoamingPets:FindFirstChild("Pets")
            if folder then
                local potentialTargets = {}
                for _, pet in pairs(folder:GetChildren()) do
                    if not getgenv().AutoFarmRarity then break end

                    -- === FILTER BARU: CEK BLACKLIST NAMA ===
                    local pName = pet:GetAttribute("Name") or pet.Name
                    if table.find(getgenv().IgnoredPets, pName) then
                        -- Jika nama ada di blacklist, SKIP (Lanjut ke pet berikutnya)
                        continue
                    end
                    -- =======================================

                    local r = pet:GetAttribute("Rarity")
                    local m = pet:GetAttribute("Mutation")
                    local isTarget = false

                    if getgenv().MutationOnly then
                        if m and m ~= "None" then isTarget = true end
                    else
                        if table.find(getgenv().TargetCatchRarities, r) then isTarget = true end
                    end

                    if isTarget and (pet:IsA("Model") or pet:IsA("BasePart")) then
                        table.insert(potentialTargets, pet)
                    end
                end

                if #potentialTargets > 0 then
                    -- Priority Sort (Sama seperti sebelumnya)
                    table.sort(potentialTargets, function(a, b)
                        local rA = a:GetAttribute("Rarity") or "Common"
                        local rB = b:GetAttribute("Rarity") or "Common"
                        local wA = RarityWeights[rA] or 0
                        local wB = RarityWeights[rB] or 0
                        if a:GetAttribute("Mutation") ~= "None" then wA = wA + 100 end
                        if b:GetAttribute("Mutation") ~= "None" then wB = wB + 100 end
                        return wA > wB
                    end)

                    local bestTarget = potentialTargets[1]
                    local p = game.Players.LocalPlayer
                    if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        p.Character.HumanoidRootPart.CFrame = bestTarget:GetPivot() * CFrame.new(0, 3, 0)
                        task.wait(0.2)
                        RunCatchProtocol(bestTarget)
                        task.wait(4.5)
                    end
                end
            end
            task.wait(1)
        end
    end)
end
local function StartAutoCollect()
    task.spawn(
        function()
            while getgenv().AutoCollectCash do
                local p = game.Players.LocalPlayer

                local pensFolder = workspace:FindFirstChild("PlayerPens")

                local myPen = nil

                if pensFolder then
                    for _, pen in pairs(pensFolder:GetChildren()) do
                        local ownerName = pen:GetAttribute("Owner")

                        if ownerName == p.Name then
                            myPen = pen

                            break
                        end
                    end
                end

                if myPen then
                    local petsFolder = myPen:FindFirstChild("Pets")

                    if petsFolder then
                        for _, pet in pairs(petsFolder:GetChildren()) do
                            if not getgenv().AutoCollectCash then
                                break
                            end

                            pcall(
                                function()
                                    local args = {
                                        [1] = pet.Name
                                    }

                                    game:GetService("ReplicatedStorage"):WaitForChild("Remotes"):WaitForChild(
                                        "collectPetCash"
                                    ):FireServer(unpack(args))
                                end
                            )

                            task.wait(0.05)
                        end
                    end
                end

                task.wait(2)
            end
        end
    )
end

local function StartAutoSell()
    task.spawn(
        function()
            while getgenv().AutoSell do
                local RS = game:GetService("ReplicatedStorage")

                local success, inventory =
                    pcall(
                        function()
                            return RS.Remotes.getPetInventory:InvokeServer()
                        end
                    )

                if success and inventory then
                    local soldCount = 0

                    for uuid, data in pairs(inventory) do
                        if not getgenv().AutoSell then
                            break
                        end

                        if data.rarity and getgenv().SellConfig[data.rarity] then
                            if not data.equipped and not data.isEquipped then
                                pcall(
                                    function()
                                        RS.Remotes.sellPet:InvokeServer(uuid, false)
                                    end
                                )

                                soldCount = soldCount + 1

                                task.wait(0.1)
                            end
                        end
                    end
                end

                task.wait(3)
            end
        end
    )
end

local function StartAutoBuy()
    task.spawn(
        function()
            while getgenv().AutoBuyFood do
                local success, err =
                    pcall(
                        function()
                            local RS = game:GetService("ReplicatedStorage")

                            local Packages = RS:WaitForChild("Packages")

                            local Index = Packages:WaitForChild("_Index")

                            local KnitPkg = Index:WaitForChild("sleitnick_knit@1.7.0")

                            local Services = KnitPkg:WaitForChild("knit"):WaitForChild("Services")

                            local BuyRemote =
                                Services:WaitForChild("FoodService"):WaitForChild("RE"):WaitForChild("BuyFood")

                            if BuyRemote then
                                for _, foodName in pairs(getgenv().SelectedFoodList) do
                                    if not getgenv().AutoBuyFood then
                                        break
                                    end

                                    BuyRemote:FireServer(foodName, getgenv().BuyAmount)

                                    task.wait(0.2)
                                end
                            end
                        end
                    )

                task.wait(1)
            end
        end
    )
end
local function StartWalkSpeedLoop()
    task.spawn(function()
        while getgenv().EnableWalkSpeed do
            pcall(function()
                local char = game.Players.LocalPlayer.Character
                if char and char:FindFirstChild("Humanoid") then
                    char.Humanoid.WalkSpeed = getgenv().WalkSpeedValue
                end
            end)
            task.wait() -- Loop cepat agar override sistem game
        end

        -- Reset ke normal saat dimatikan
        pcall(function()
            game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = 16
        end)
    end)
end
local function StartAutoFeedAllFoodsToTarget()
    task.spawn(function()
        while getgenv().AutoFeedAllFoods do
            -- Pastikan ada target pet yang dipilih
            if getgenv().TargetPetUUID then
                -- Loop semua makanan yang ada di daftar foodList
                for _, foodName in ipairs(foodList) do
                    if not getgenv().AutoFeedAllFoods then break end

                    pcall(function()
                        local FeedRemote = game:GetService("ReplicatedStorage").Packages._Index["sleitnick_knit@1.7.0"]
                            .knit.Services.FoodService.RF.FeedPet

                        -- Feed makanan tersebut ke Target Pet
                        FeedRemote:InvokeServer(foodName, getgenv().TargetPetUUID, 1)
                    end)

                    -- Delay cepat antar suapan
                    task.wait(0.1)
                end
            end

            -- Ulangi loop (beri jeda sedikit agar tidak crash)
            task.wait(0.5)
        end
    end)
end
local function StartRecipeBreeding()
    task.spawn(function()
        while getgenv().AutoBreedRecipe do
            -- Cek apakah user sudah memilih resep
            if getgenv().SelectedRecipe and recipeMap[getgenv().SelectedRecipe] then
                local targetData = recipeMap[getgenv().SelectedRecipe]
                local p1Target = targetData.P1
                print("Target P1: " .. p1Target)
                local p2Target = targetData.P2
                print("Target P2: " .. p2Target)

                local myPen = GetMyPen()
                if myPen and myPen:FindFirstChild("Pets") then
                    -- List penampung pet yang valid (tidak cooldown)
                    local listP1 = {}
                    local listP2 = {}

                    for _, pet in pairs(myPen.Pets:GetChildren()) do
                        if pet:IsA("Model") and not pet:GetAttribute("CooldownEnd") then
                            local pName = pet:GetAttribute("Name") -- Ambil nama asli pet (bukan nama object)

                            -- Masukkan ke list jika namanya cocok
                            if pName == p1Target then
                                table.insert(listP1, pet)
                            elseif pName == p2Target then
                                table.insert(listP2, pet)
                            end
                        end
                    end

                    -- LOGIKA PASANGAN
                    local pairsBred = 0

                    -- Loop sebanyak jumlah pasangan yang mungkin
                    -- Kita ambil jumlah terkecil dari kedua list agar pasangannya pas
                    local maxPairs = math.min(#listP1, #listP2)

                    if maxPairs > 0 then
                        for i = 1, maxPairs do
                            local parentA = listP1[i]
                            local parentB = listP2[i]

                            if parentA and parentB then
                                pcall(function()
                                    game:GetService("ReplicatedStorage").Remotes.breedRequest:InvokeServer(
                                        parentA,
                                        parentB,
                                        parentA:GetPivot().Position,
                                        parentB:GetPivot().Position
                                    )
                                end)
                                pairsBred = pairsBred + 1
                                task.wait(0.2)
                            end
                        end

                        if pairsBred > 0 then
                            WindUI:Notify({
                                Title = "Recipe Breeder",
                                Content = "Bred " .. pairsBred .. " pairs of " .. p1Target .. " + " .. p2Target,
                                Duration = 2
                            })
                        end
                    end
                end
            end

            task.wait(5) -- Delay scan loop
        end
    end)
end

local function StartSmartAutoBreed()
    task.spawn(function()
        while getgenv().AutoBreed do
            local myPen = GetMyPen()

            if myPen then
                local petsFolder = myPen:FindFirstChild("Pets")
                if petsFolder then
                    local readyPets = {}

                    -- 1. Filter pets: Check Cooldown AND Rarity
                    for _, pet in pairs(petsFolder:GetChildren()) do
                        if pet:IsA("Model") then
                            local cooldown = pet:GetAttribute("CooldownEnd")
                            local rarity = pet:GetAttribute("Rarity")

                            -- Check if pet is free (no cooldown)
                            if not cooldown then
                                -- Check if the pet's rarity is in our selected list
                                if table.find(getgenv().SelectedBreedRarities, rarity) then
                                    table.insert(readyPets, pet)
                                end
                            end
                        end
                    end

                    -- 2. Check availability
                    if #readyPets < 2 then
                        -- Optional: Only notify if the user explicitly wants to know, to avoid spam
                        WindUI:Notify({
                            Title = "Status",
                            Content =
                            "Pet are cooldown or Not enough pets with selected rarity ready .",
                            Duration = 2
                        })
                    else
                        -- 3. Pairing Logic
                        local pairsBred = 0

                        -- Step by 2 (Pair i with i+1)
                        for i = 1, #readyPets, 2 do
                            local parent1 = readyPets[i]
                            local parent2 = readyPets[i + 1]

                            -- Ensure both exist
                            if parent1 and parent2 then
                                pcall(function()
                                    game:GetService("ReplicatedStorage").Remotes.breedRequest:InvokeServer(
                                        parent1,
                                        parent2,
                                        parent1:GetPivot().Position,
                                        parent2:GetPivot().Position
                                    )
                                end)
                                pairsBred = pairsBred + 1
                                task.wait(0.2)
                            end
                        end

                        if pairsBred > 0 then
                            WindUI:Notify({
                                Title = "Auto Breed",
                                Content = "Paired " .. tostring(pairsBred) .. " couples matching filters.",
                                Duration = 2
                            })
                        end
                    end
                end
            end

            task.wait(5)
        end
    end)
end
local function StartAutoBreedAllRecipes()
    task.spawn(function()
        while getgenv().AutoBreedAllRecipes do
            local myPen = GetMyPen()

            if myPen and myPen:FindFirstChild("Pets") then
                -- Langkah 1: Kelompokkan Pet yang READY (No Cooldown) berdasarkan Namanya
                local petInventory = {}

                for _, pet in pairs(myPen.Pets:GetChildren()) do
                    if pet:IsA("Model") and not pet:GetAttribute("CooldownEnd") then
                        local pName = pet:GetAttribute("Name") -- Ambil nama asli spesies

                        if pName then
                            if not petInventory[pName] then
                                petInventory[pName] = {}
                            end
                            table.insert(petInventory[pName], pet)
                        end
                    end
                end

                -- Langkah 2: Cek Resep Game satu per satu
                -- BreedRecipes adalah variabel yang kamu require di jawaban sebelumnya
                local totalBred = 0

                for _, recipeData in pairs(BreedRecipes) do
                    -- Jika user mematikan toggle di tengah jalan, hentikan loop
                    if not getgenv().AutoBreedAllRecipes then break end

                    local p1Name = recipeData.Parent1
                    local p2Name = recipeData.Parent2

                    -- Cek apakah kita punya stok untuk kedua parent ini
                    if petInventory[p1Name] and petInventory[p2Name] then
                        -- LOOP: Kawinkan sampai stok habis untuk resep ini
                        while true do
                            local parentA = nil
                            local parentB = nil

                            -- KASUS 1: Spesies Sama (Misal: Wolf + Wolf)
                            if p1Name == p2Name then
                                if #petInventory[p1Name] >= 2 then
                                    parentA = table.remove(petInventory[p1Name], 1)
                                    parentB = table.remove(petInventory[p1Name], 1)
                                else
                                    break -- Stok tidak cukup untuk pasangan sejenis
                                end

                                -- KASUS 2: Spesies Beda (Misal: Lion + Tiger)
                            else
                                if #petInventory[p1Name] >= 1 and #petInventory[p2Name] >= 1 then
                                    parentA = table.remove(petInventory[p1Name], 1)
                                    parentB = table.remove(petInventory[p2Name], 1)
                                else
                                    break -- Salah satu stok habis
                                end
                            end

                            -- Eksekusi Breed
                            if parentA and parentB then
                                pcall(function()
                                    game:GetService("ReplicatedStorage").Remotes.breedRequest:InvokeServer(
                                        parentA,
                                        parentB,
                                        parentA:GetPivot().Position,
                                        parentB:GetPivot().Position
                                    )
                                end)
                                totalBred = totalBred + 1
                                task.wait(0.2) -- Delay kecil agar server tidak menolak
                            end
                        end
                    end
                end

                if totalBred > 0 then
                    WindUI:Notify({
                        Title = "Auto Recipe",
                        Content = "Successfully bred " .. totalBred .. " pairs from all recipes.",
                        Duration = 2
                    })
                else
                    WindUI:Notify({
                        Title = "Auto Recipe",
                        Content = "Pet CD or No available pairs found for any recipe.",
                        Duration = 2
                    })
                end
            end

            task.wait(5) -- Scan ulang setiap 5 detik
        end
    end)
end
local function StartAutoCollectFruits()
    task.spawn(function()
        while getgenv().AutoCollectFruits do
            local visuals = workspace:FindFirstChild("WeatherVisuals")

            if visuals then
                -- Loop semua anak di folder (Model dengan nama UUID)
                for _, model in pairs(visuals:GetChildren()) do
                    if not getgenv().AutoCollectFruits then break end

                    -- Cari buah di dalam model tersebut
                    local fruit = model:FindFirstChild("CosmicFruit") or model:FindFirstChild("VolcanicFruit")

                    if fruit then
                        -- Cari ProximityPrompt (biasanya ada langsung di dalam Model Fruit atau di Handle)
                        local prompt = fruit:FindFirstChildWhichIsA("ProximityPrompt") or
                            (fruit:FindFirstChild("Handle") and fruit.Handle:FindFirstChildWhichIsA("ProximityPrompt"))

                        if prompt and prompt.Enabled then
                            local p = game.Players.LocalPlayer
                            if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                                -- PERBAIKAN: Gunakan :GetPivot() karena target adalah Model
                                p.Character.HumanoidRootPart.CFrame = fruit:GetPivot()
                            end

                            -- Delay agar server mendeteksi player sudah dekat
                            task.wait(0.25)

                            -- Eksekusi Prompt (Bypass waktu tahan 3 detik)
                            fireproximityprompt(prompt)

                            -- Tunggu sebentar agar tidak spamming error
                            task.wait(0.1)
                        end
                    end
                end
            end
            task.wait(1)
        end
    end)
end
local function StartEggManager()
    task.spawn(function()
        while getgenv().EnableEggManager do
            local myPen = GetMyPen()

            if myPen and myPen:FindFirstChild("Eggs") then
                local eggs = myPen.Eggs:GetChildren()

                if #eggs > 0 then
                    for _, egg in pairs(eggs) do
                        if not getgenv().EnableEggManager then break end

                        -- MODE: PICKUP
                        if getgenv().EggAction == "Pickup" then
                            -- Logic from your previous request
                            pcall(function()
                                game:GetService("ReplicatedStorage").Remotes.pickupRequest:InvokeServer(
                                    "Egg",
                                    egg.Name,
                                    egg
                                )
                            end)
                            task.wait(0.5) -- Pickup speed

                            -- MODE: HATCH
                        elseif getgenv().EggAction == "Hatch" then
                            -- Logic using the new Hatch Remote
                            pcall(function()
                                local HatchRemote = game:GetService("ReplicatedStorage").Packages._Index
                                    ["sleitnick_knit@1.7.0"].knit.Services.TimerService.RF.RequestEggHatch

                                -- Assuming egg.Name is the UUID required
                                HatchRemote:InvokeServer(egg.Name)
                            end)

                            -- Hatching usually has an animation, so we wait longer to avoid errors
                            task.wait(3.5)
                        end
                    end
                end
            end

            task.wait(1)
        end
    end)
end

local function StartAutoPickupPets()
    task.spawn(function()
        while getgenv().AutoPickupPets do
            local myPen = GetMyPen()
            if myPen then
                local petsFolder = myPen:FindFirstChild("Pets")
                if petsFolder then
                    for _, pet in pairs(petsFolder:GetChildren()) do
                        if not getgenv().AutoPickupPets then break end

                        -- Cek apakah Rarity pet ini ada di daftar pilihan kita
                        local rarity = pet:GetAttribute("Rarity")
                        if pet:IsA("Model") and table.find(getgenv().PickupPetRarities, rarity) then
                            pcall(function()
                                -- Argument: "Pet", UUID, ObjectInstance
                                game:GetService("ReplicatedStorage").Remotes.pickupRequest:InvokeServer(
                                    "Pet",
                                    pet.Name, -- UUID
                                    pet       -- Instance
                                )
                            end)
                            task.wait(0.1) -- Delay kecil agar tidak disconnect
                        end
                    end
                end
            end
            task.wait(1)
        end
    end)
end

local function StartAutoPickupEggs()
    task.spawn(function()
        while getgenv().AutoPickupEggs do
            local myPen = GetMyPen()
            if myPen then
                local eggsFolder = myPen:FindFirstChild("Eggs")
                if eggsFolder then
                    for _, egg in pairs(eggsFolder:GetChildren()) do
                        if not getgenv().AutoPickupEggs then break end

                        -- Kita asumsikan nama telur di game formatnya "Rarity Egg"
                        -- Kita ambil atribut nama, atau jika tidak ada, gunakan nama part
                        local eggName = egg:GetAttribute("EggName") or egg.EggName

                        -- Cek apakah nama telur ini ada di daftar yang kita pilih
                        if table.find(getgenv().PickupEggNames, eggName) then
                            pcall(function()
                                game:GetService("ReplicatedStorage").Remotes.pickupRequest:InvokeServer(
                                    "Egg",
                                    egg.Name, -- UUID telur
                                    egg       -- Instance telur
                                )
                            end)
                            task.wait(0.1) -- Delay aman
                        end
                    end
                end
            end
            task.wait(1)
        end
    end)
end
local function UpdatePetList()
    petMap = {}

    local listForDropdown = {}

    local myPen = GetMyPen()

    if myPen then
        local petsFolder = myPen:FindFirstChild("Pets")

        if petsFolder then
            for _, pet in pairs(petsFolder:GetChildren()) do
                local pName = pet:GetAttribute("Name") or "Unknown"

                local pLevel = pet:GetAttribute("Level") or 0
                local pMutate = pet:GetAttribute("Mutation") or "None"

                local displayName = pName .. " (" .. tostring(pLevel) .. ")" .. " " .. pMutate .. " "

                if petMap[displayName] then
                    displayName = displayName .. " [" .. string.sub(pet.Name, 1, 3) .. "]"
                end

                petMap[displayName] = pet.Name

                table.insert(listForDropdown, displayName)
            end
        end
    end

    table.sort(listForDropdown)

    return listForDropdown
end

local function StartAutoFeed()
    task.spawn(
        function()
            while getgenv().AutoFeed do
                if getgenv().TargetPetUUID then
                    local success, err =
                        pcall(
                            function()
                                local FeedRemote =
                                    game:GetService("ReplicatedStorage").Packages._Index["sleitnick_knit@1.7.0"].knit
                                    .Services.FoodService.RF.FeedPet

                                FeedRemote:InvokeServer(getgenv().SelectedFeedFood, getgenv().TargetPetUUID, 1)
                            end
                        )
                end

                task.wait(0.2)
            end
        end
    )
end
local function StartAutoSellEggs()
    task.spawn(function()
        while getgenv().AutoSellEggs do
            local inv = GetEggInventoryData()

            if inv then
                local soldCount = 0
                for uuid, data in pairs(inv) do
                    if not getgenv().AutoSellEggs then break end

                    -- PERBAIKAN: Gunakan data.type == "Egg" alih-alih data.name
                    if data.type == "Egg" then
                        -- Cek apakah Rarity telur ini ada di daftar yang ingin dijual user
                        if data.rarity and table.find(getgenv().SellEggConfig, data.rarity) then
                            pcall(function()
                                game:GetService("ReplicatedStorage").Remotes.sellEgg:InvokeServer(uuid, false)
                            end)

                            soldCount = soldCount + 1
                            task.wait(0.1) -- Jeda dikit biar server tidak menolak
                        end
                    end
                end

                -- Opsional: Info di F9 jika ada yang terjual
                if soldCount > 0 then
                    print("Auto Sell: Sold " .. soldCount .. " eggs.")
                end
            end

            task.wait(3) -- Loop setiap 3 detik
        end
    end)
end
local Section =
    Tab:Section(
        {
            Title = "Target"
        }
    )

Section:Dropdown({
    Title = "Target Rarities (Multi-Select)",
    Values = rarityList, -- List sudah mencakup Secret & Exclusive
    Value = {},          -- Default kosong
    Multi = true,        -- Aktifkan Multi Select
    Desc = "Select multiple rarities. Script prioritizes the highest tier automatically.",
    Callback = function(Options)
        getgenv().TargetCatchRarities = Options
    end
})

Section:Toggle(
    {
        Title = "Mutation Only",
        Value = false,
        Callback = function(Val)
            getgenv().MutationOnly = Val
        end
    }
)

Section:Toggle(
    {
        Title = "Auto Catch (After Teleport)",
        Value = true,
        Callback = function(Val)
            getgenv().AutoCatchEnabled = Val
        end
    }
)
Section:Dropdown({
    Title = "Ignore Pets (Blacklist)",
    Values = fullPetNameList, -- List nama yang diambil dari config v1 tadi
    Value = {},
    Multi = true,
    SearchBarEnabled = true,
    Desc = "Select pets you do NOT want to catch (Name based).",
    Callback = function(v)
        getgenv().IgnoredPets = v
    end
})

local SectionExecution =
    Tab:Section(
        {
            Title = "Execution"
        }
    )



SectionExecution:Button(
    {
        Title = "Catch 1 Target (Safe Mode)",
        Callback = function()
            WindUI:Notify({ Title = "Manual Mode", Content = "Searching for 1 target...", Duration = 2 })

            local folder = workspace:FindFirstChild("RoamingPets") and workspace.RoamingPets:FindFirstChild("Pets")

            if not folder then
                return
            end

            local found = false

            for _, pet in pairs(folder:GetChildren()) do
                local r = pet:GetAttribute("Rarity")

                local m = pet:GetAttribute("Mutation")

                local isTarget = false

                if getgenv().MutationOnly then
                    if m and m ~= "None" then
                        isTarget = true
                    end
                elseif r == getgenv().SelectRarity then
                    isTarget = true
                end

                if isTarget and (pet:IsA("Model") or pet:IsA("BasePart")) then
                    found = true

                    local p = game.Players.LocalPlayer

                    if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                        p.Character.HumanoidRootPart.CFrame = pet:GetPivot() * CFrame.new(0, 5, 5)

                        task.wait(0.5)

                        p.Character.HumanoidRootPart.CFrame = pet:GetPivot()

                        task.wait(1)

                        RunCatchProtocol(pet)

                        WindUI:Notify({ Title = "Done", Content = "Target processed.", Duration = 2 })
                    end

                    break
                end
            end

            if not found then
                WindUI:Notify({ Title = "Empty", Content = "No target found " .. getgenv().SelectRarity, Duration = 2 })
            end
        end
    }
)

SectionExecution:Toggle({
    Title = "Auto Farm Priority (Loop)",
    Value = false,
    Desc = "Scans map and catches the BEST pet from your selection.",
    Callback = function(Value)
        getgenv().AutoFarmRarity = Value

        if Value then
            if #getgenv().TargetCatchRarities == 0 and not getgenv().MutationOnly then
                WindUI:Notify({ Title = "Warning", Content = "Select at least 1 Rarity first!", Duration = 2 })
            else
                WindUI:Notify({
                    Title = "Auto Farm ON",
                    Content = "Scanning for highest priority targets...",
                    Duration = 2
                })
                StartRarityFarm()
            end
        else
            WindUI:Notify({ Title = "Auto Farm OFF", Content = "Stopped.", Duration = 2 })
        end
    end
})
local SectionCollect =
    CollectTab:Section(
        {
            Title = "Farming Features"
        }
    )

SectionCollect:Toggle(
    {
        Title = "Auto Collect Cash (My Pen)",
        Value = false,
        Desc = "AutoCollectToggle",
        Callback = function(Value)
            getgenv().AutoCollectCash = Value

            if Value then
                WindUI:Notify({ Title = "Auto Collect ON", Content = "Collecting cash from your Pen...", Duration = 2 })

                StartAutoCollect()
            else
                WindUI:Notify({ Title = "Auto Collect OFF", Content = "Stopped collecting cash.", Duration = 2 })
            end
        end
    }
)


-- === SECTION: PETS ===
SellTab:Section({ Title = "Pet Selling" })

SellTab:Dropdown({
    Title = "Select Pet Rarities",
    Values = rarityList, -- List dari Common s/d Secret
    Value = {},
    Multi = true,        -- Multi Select Aktif
    Desc = "Select which pet rarities to auto-sell.",
    Callback = function(Options)
        getgenv().SellConfig = Options
    end
})

SellTab:Toggle({
    Title = "Auto Sell Pets (Loop)",
    Value = false,
    Desc = "Automatically sells pets based on the selection above.",
    Callback = function(v)
        getgenv().AutoSell = v
        if v then
            -- Safety Check
            if #getgenv().SellConfig == 0 then
                WindUI:Notify({ Title = "Warning", Content = "Select at least one Pet Rarity first!", Duration = 2 })
            else
                WindUI:Notify({ Title = "System", Content = "Auto Sell Pets Started...", Duration = 2 })

                -- Logic Loop (Langsung di dalam callback agar praktis)
                task.spawn(function()
                    while getgenv().AutoSell do
                        local inv = GetInventoryData()
                        if inv then
                            for uuid, d in pairs(inv) do
                                if not getgenv().AutoSell then break end

                                -- Filter: Pastikan BUKAN Egg, Rarity cocok, dan Tidak Placed
                                if d.name and not string.find(d.name, "Egg") then
                                    if d.rarity and table.find(getgenv().SellConfig, d.rarity) and not d.placed then
                                        pcall(function()
                                            game:GetService("ReplicatedStorage").Remotes.sellPet:InvokeServer(uuid, false)
                                        end)
                                        task.wait(0.1)
                                    end
                                end
                            end
                        end
                        task.wait(3) -- Cek setiap 3 detik
                    end
                end)
            end
        else
            WindUI:Notify({ Title = "System", Content = "Auto Sell Pets Stopped.", Duration = 2 })
        end
    end
})

-- === SECTION: EGGS ===
SellTab:Section({ Title = "Egg Selling" })

-- Ganti Toggle banyak dengan 1 Dropdown Multi
SellTab:Dropdown({
    Title = "Select Egg Rarities",
    Values = rarityList, -- Menggunakan list rarity yang sudah ada (Common s/d Secret)
    Value = {},
    Multi = true,        -- Multi Select aktif
    Desc = "Select which egg rarities to auto-sell.",
    Callback = function(Options)
        getgenv().SellEggConfig = Options
    end
})

SellTab:Toggle({
    Title = "Auto Sell Eggs (Loop)",
    Value = false,
    Desc = "Automatically sells unwanted eggs based on the selection above.",
    Callback = function(v)
        getgenv().AutoSellEggs = v

        if v then
            -- Safety check: Pastikan user memilih minimal 1 rarity
            if #getgenv().SellEggConfig == 0 then
                WindUI:Notify({ Title = "Warning", Content = "Select at least one Egg Rarity first!", Duration = 2 })
            else
                WindUI:Notify({ Title = "System", Content = "Auto Sell Eggs Started...", Duration = 2 })
                StartAutoSellEggs()
            end
        else
            WindUI:Notify({ Title = "System", Content = "Auto Sell Eggs Stopped.", Duration = 2 })
        end
    end
})
local SectionBuy =
    BuyTab:Section(
        {
            Title = "Purchase Configuration"
        }
    )

BuyTab:Dropdown(
    {
        Title = "Select Food (Multi-select)",
        Values = foodList,
        Value = { "Apple" },
        Multi = true,
        Desc = "FoodDropdownMulti",
        Callback = function(Option)
            getgenv().SelectedFoodList = Option
        end
    }
)

BuyTab:Slider(
    {
        Title = "Amount Per Item",
        Value = {
            Min = 1,
            Max = 100,
            Default = 5
        },
        Step = 1,
        Desc = "BuyAmountSlider",
        Callback = function(Value)
            getgenv().BuyAmount = Value
        end
    }
)

local SectionExec = BuyTab:Section({ Title = "Execution" })

BuyTab:Toggle(
    {
        Title = "Auto Buy Food (Loop)",
        Value = false,
        Desc = "AutoBuyToggle",
        Callback = function(Value)
            getgenv().AutoBuyFood = Value

            if Value then
                WindUI:Notify({ Title = "Auto Buy ON", Content = "Buying food...", Duration = 2 })

                StartAutoBuy()
            else
                WindUI:Notify({ Title = "Auto Buy OFF", Content = "Stopped.", Duration = 2 })
            end
        end
    }
)

local SectionConfig = FeedTab:Section({ Title = "1. Select Food" })

FeedTab:Dropdown(
    {
        Title = "Food Type",
        Values = foodList,
        Value = "Steak",
        Multi = false,
        Desc = "FeedFoodDrop",
        Callback = function(Option)
            local val = (type(Option) == "table" and Option[1]) or Option

            getgenv().SelectedFeedFood = val
        end
    }
)

local SectionTarget = FeedTab:Section({ Title = "2. Select Target Pet" })

local PetDropdown =
    FeedTab:Dropdown(
        {
            Title = "Target Pet",
            Values = { "Click Refresh First..." },
            Value = "",
            Multi = false,
            Desc = "TargetPetDrop",
            Callback = function(Option)
                local selectedName = (type(Option) == "table" and Option[1]) or Option

                if petMap[selectedName] then
                    local realUUID = petMap[selectedName]

                    getgenv().TargetPetUUID = realUUID

                    WindUI:Notify({ Title = "Target Set", Content = "Pet ID saved.", Duration = 1 })
                end
            end
        }
    )

FeedTab:Button(
    {
        Title = "Refresh Pet List (Click when changing pet)",
        Callback = function()
            local newList = UpdatePetList()

            PetDropdown:Refresh(newList)

            WindUI:Notify({ Title = "Updated", Content = "Pet list updated!", Duration = 1 })
        end
    }
)

local SectionExec = FeedTab:Section({ Title = "Execution" })

FeedTab:Toggle(
    {
        Title = "Auto Feed Selected Target (Loop)",
        Value = false,
        Desc = "AutoFeedSpecific",
        Callback = function(Value)
            getgenv().AutoFeed = Value

            if Value then
                if getgenv().TargetPetUUID then
                    StartAutoFeed()

                    WindUI:Notify({ Title = "Auto Feed ON", Content = "Feeding started...", Duration = 2 })
                else
                    WindUI:Notify({ Title = "Error", Content = "Select a Pet above first!", Duration = 2 })
                end
            end
        end
    }
)

local Keybind =
    SettingTab:Keybind(
        {
            Title = "Keybind",
            Desc = "Keybind to open ui",
            Value = "K",
            Callback = function(v)
                Window:SetToggleKey(Enum.KeyCode[v])
            end
        }
    )

local ThemeDropdown =
    SettingTab:Dropdown(
        {
            Title = "Select Theme",
            Desc = "Choose your desired interface theme",
            Values = {
                "Material Nature Dark",
                "Material Nature Light",
                "Pacific Dark",
                "Peach Glow Dominant",
                "Rose",
                "Plant",
                "Red",
                "Indigo",
                "Sky",
                "Violet",
                "Amber",
                "Emerald",
                "Midnight",
                "Crimson",
                "Monokai Pro",
                "Cotton Candy",
                "Rainbow"
            },
            Value = "Plant",
            Callback = function(option)
                WindUI:SetTheme(option)
            end
        }
    )
-- Breeding Section
BreedTab:Section({
    Title = "Smart Breeding Configuration"
})

-- Dropdown to select which rarities to breed
BreedTab:Dropdown({
    Title = "Filter Rarity (Multi-Select)",
    Values = { "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical" },
    Value = {}, -- Default empty, user must select
    Multi = true,
    Desc = "Select rarities you want to auto breed.",
    Callback = function(Options)
        -- WindUI Multi-Dropdown returns a table of strings, e.g. {"Legendary", "Mythical"}
        getgenv().SelectedBreedRarities = Options
    end
})

BreedTab:Toggle({
    Title = "Enable Smart Auto Breed",
    Desc = "Pairs ready pets based on selected rarities.",
    Value = false,
    Callback = function(Value)
        getgenv().AutoBreed = Value

        if Value then
            -- Safety check: Warn if no rarity is selected
            if #getgenv().SelectedBreedRarities == 0 then
                WindUI:Notify({
                    Title = "Warning",
                    Content = "Please select at least one Rarity in the dropdown!",
                    Duration = 3
                })
            end

            WindUI:Notify({
                Title = "System",
                Content = "Smart Breeding Started...",
                Duration = 2
            })
            StartSmartAutoBreed()
        else
            WindUI:Notify({
                Title = "System",
                Content = "Smart Breeding Stopped.",
                Duration = 2
            })
        end
    end
})
local breedRecipeSection = BreedTab:Section({ Title = "Recipe Auto Breed" })

local RecipeDropdown = breedRecipeSection:Dropdown({
    Title = "Select Recipe",
    Values = recipeList, -- Mengambil dari fungsi GetFormattedRecipes tadi
    Value = "Select Recipe...",
    Multi = false,
    Desc = "Choose specific breeding combination provided by the game.",
    Callback = function(Option)
        -- Handle return value WindUI
        local val = (type(Option) == "table" and Option[1]) or Option
        getgenv().SelectedRecipe = val
    end
})

breedRecipeSection:Button({
    Title = "Refresh Recipes",
    Desc = "Click if game updates or list is empty.",
    Callback = function()
        -- Reload resep jika diperlukan
        local newList, newMap = GetFormattedRecipes()
        recipeList = newList
        recipeMap = newMap
        RecipeDropdown:Refresh(newList)
        WindUI:Notify({ Title = "System", Content = "Recipes list updated!", Duration = 1 })
    end
})

breedRecipeSection:Toggle({
    Title = "Start Recipe Breeding",
    Desc = "Auto breed pets based on the selected recipe above.",
    Value = false,
    Callback = function(Value)
        getgenv().AutoBreedRecipe = Value

        if Value then
            if not getgenv().SelectedRecipe then
                WindUI:Notify({ Title = "Error", Content = "Please select a recipe first!", Duration = 2 })
                return
            end

            WindUI:Notify({ Title = "System", Content = "Recipe Breeding Started...", Duration = 2 })
            StartRecipeBreeding()
        else
            WindUI:Notify({ Title = "System", Content = "Recipe Breeding Stopped.", Duration = 2 })
        end
    end
})
breedRecipeSection:Divider()
breedRecipeSection:Toggle({
    Title = "Auto Breed ALL Recipes",
    Desc = "Automatically detects and breeds ALL matching pairs found in your pen.",
    Value = false,
    Callback = function(Value)
        getgenv().AutoBreedAllRecipes = Value

        if Value then
            -- Matikan fitur breed lain agar tidak bentrok
            if getgenv().AutoBreed or getgenv().AutoBreedRecipe then
                WindUI:Notify({ Title = "System", Content = "Disabled other breed modes to prevent conflict.", Duration = 2 })
                getgenv().AutoBreed = false
                getgenv().AutoBreedRecipe = false
                -- Jangan lupa update visual toggle lain ke false jika library mendukung,
                -- atau biarkan saja user yang mematikan.
            end

            WindUI:Notify({
                Title = "System",
                Content = "Scanning inventory for ANY valid recipes...",
                Duration = 2
            })
            StartAutoBreedAllRecipes()
        else
            WindUI:Notify({
                Title = "System",
                Content = "Auto Breed All Stopped.",
                Duration = 2
            })
        end
    end
})
local eggBreadSection = BreedTab:Section({
    Title = "Egg Management"
})

-- Dropdown to select Action (Only one can be active)
eggBreadSection:Dropdown({
    Title = "Egg Action Mode",
    Values = { "Pickup", "Hatch" },
    Value = "Pickup",
    Multi = false,
    Desc = "Choose to either Pickup eggs to inventory OR Hatch them directly.",
    Callback = function(Option)
        -- Handle both string or table return from WindUI
        local val = (type(Option) == "table" and Option[1]) or Option
        getgenv().EggAction = val

        WindUI:Notify({
            Title = "Mode Changed",
            Content = "Switched to: " .. val .. " Mode.",
            Duration = 1
        })
    end
})

-- Master Toggle for Egg Features
eggBreadSection:Toggle({
    Title = "Enable Egg Manager",
    Value = false,
    Callback = function(Value)
        getgenv().EnableEggManager = Value

        if Value then
            WindUI:Notify({
                Title = "Egg Manager",
                Content = "Started " .. getgenv().EggAction .. " eggs...",
                Duration = 2
            })
            StartEggManager()
        else
            WindUI:Notify({
                Title = "Egg Manager",
                Content = "Stopped.",
                Duration = 2
            })
        end
    end
})

PickupTab:Section({ Title = "Pet Pickup Config" })

PickupTab:Dropdown({
    Title = "Filter Rarity (Multi)",
    Values = { "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical" },
    Value = {},
    Multi = true,
    Desc = "Select rarities to auto pickup.",
    Callback = function(Options)
        getgenv().PickupPetRarities = Options
    end
})

PickupTab:Toggle({
    Title = "Auto Pickup Pets",
    Desc = "Pick up pets matching the selected rarities.",
    Value = false,
    Callback = function(Value)
        getgenv().AutoPickupPets = Value
        if Value then
            -- Safety check
            if #getgenv().PickupPetRarities == 0 then
                WindUI:Notify({ Title = "Warning", Content = "Select at least 1 Rarity first!", Duration = 2 })
            else
                StartAutoPickupPets()
                WindUI:Notify({ Title = "System", Content = "Started picking up pets...", Duration = 2 })
            end
        end
    end
})

-- SECTION: EGGS
PickupTab:Section({ Title = "Egg Pickup Config" })

PickupTab:Dropdown({
    Title = "Filter Egg Name (Multi)",
    Values = eggNamesList,
    Value = {},
    Multi = true,
    Desc = "Select specific egg rarities to pickup.",
    Callback = function(Options)
        getgenv().PickupEggNames = Options
    end
})

PickupTab:Toggle({
    Title = "Auto Pickup Eggs",
    Value = false,
    Callback = function(Value)
        getgenv().AutoPickupEggs = Value
        if Value then
            -- Safety Check
            if #getgenv().PickupEggNames == 0 then
                WindUI:Notify({ Title = "Warning", Content = "Select egg types from the dropdown first!", Duration = 2 })
            else
                StartAutoPickupEggs()
                WindUI:Notify({ Title = "System", Content = "Started picking up selected eggs...", Duration = 2 })
            end
        else
            WindUI:Notify({ Title = "System", Content = "Stopped picking up eggs.", Duration = 2 })
        end
    end
})

-- Logic Anti AFK (Jalankan ini sekali saja di awal script, tidak perlu dalam fungsi loop)
local VirtualUser = game:GetService("VirtualUser")
game:GetService("Players").LocalPlayer.Idled:Connect(function()
    if getgenv().AntiAfk then
        VirtualUser:CaptureController()
        VirtualUser:ClickButton2(Vector2.new())
    end
end)
SettingTab:Toggle({
    Title = "Anti AFK",
    Value = true,
    Callback = function(Value)
        getgenv().AntiAfk = Value

        if Value then
            WindUI:Notify({
                Title = "Anti AFK",
                Content = "Enabled. You can now leave your device.",
                Duration = 2
            })
        else
            WindUI:Notify({
                Title = "Anti AFK",
                Content = "Disabled.",
                Duration = 2
            })
        end
    end
})
FeedTab:Toggle({
    Title = "Auto Feed ALL Foods (To Target)",
    Desc = "Spam feeds ALL types of food to the selected target pet.",
    Value = false,
    Callback = function(Value)
        getgenv().AutoFeedAllFoods = Value

        if Value then
            if getgenv().TargetPetUUID then
                WindUI:Notify({ Title = "Feeding", Content = "Feeding everything to target...", Duration = 2 })
                StartAutoFeedAllFoodsToTarget()
            else
                WindUI:Notify({ Title = "Error", Content = "Please select a Target Pet first!", Duration = 2 })
                -- Matikan toggle secara visual jika library mendukung, atau biarkan saja
            end
        else
            WindUI:Notify({ Title = "Stopped", Content = "Stopped feeding all foods.", Duration = 2 })
        end
    end
})
local PlaceTab = Window:Tab({
    Title = "Auto Place",
    Icon = "package", -- Icon paket/box
    Locked = false
})

-- ==========================================
--  PLACE TAB (Button Version)
-- ==========================================

local placeSection = PlaceTab:Section({ Title = "Inventory Manager" })

-- Definisi Dropdown (Disimpan ke variabel agar bisa diakses fungsi)
PlaceDropdown = placeSection:Dropdown({
    Title = "Select Pets to Place",
    Values = { "Click Refresh First..." },
    Value = {},
    Multi = true,
    Desc = "Select pets to put in your pen.",
    Callback = function(v)
        local u = {}
        -- Konversi Nama Tampilan -> UUID Asli
        for _, n in pairs(v) do
            if placeableMap[n] then
                table.insert(u, placeableMap[n])
            end
        end
        getgenv().PetsToPlaceList = u
    end
})

placeSection:Button({
    Title = "Refresh Inventory",
    Callback = function()
        -- 1. Ambil data baru
        local newList, newMap = GetPlaceablePetsList()
        placeableMap = newMap

        -- 2. Kosongkan pilihan user sebelumnya (PENTING AGAR TIDAK NUMPUK)
        getgenv().PetsToPlaceList = {}

        -- 3. Update UI
        PlaceDropdown:Refresh(newList)

        WindUI:Notify({ Title = "System", Content = "Inventory refreshed & Selection cleared.", Duration = 1 })
    end
})

local executePlaceSection = PlaceTab:Section({ Title = "Execution" })

-- Ubah dari Toggle menjadi Button
executePlaceSection:Button({
    Title = "Place Selected Pets",
    Desc = "Places pets and auto-refreshes the list.",
    Callback = function()
        -- Cek apakah user sudah memilih pet
        if #getgenv().PetsToPlaceList == 0 then
            WindUI:Notify({ Title = "Warning", Content = "Please select pets from the dropdown first!", Duration = 2 })
            return
        end

        WindUI:Notify({ Title = "System", Content = "Placing pets...", Duration = 2 })
        ExecutePlacePets() -- Jalankan fungsi sekali
        PlaceDropdown:Select("")
    end
})
-- SECTION: FRUITS (Tambahkan ini di bawah section Eggs)
local fruitSection = CollectTab:Section({ Title = "Fruit Config" })

fruitSection:Toggle({
    Title = "Auto Collect Fruits",
    Desc = "Teleports and collects Volcanic & Cosmic fruits automatically.",
    Value = false,
    Callback = function(Value)
        getgenv().AutoCollectFruits = Value

        if Value then
            WindUI:Notify({ Title = "System", Content = "Searching for event fruits...", Duration = 2 })
            StartAutoCollectFruits()
        else
            WindUI:Notify({ Title = "System", Content = "Stopped collecting fruits.", Duration = 2 })
        end
    end
})
-- Tambahkan ini di dalam SettingTab (sebelum Keybind)
SettingTab:Section({ Title = "Movement" })

SettingTab:Slider({
    Title = "WalkSpeed Config",
    Desc = "Adjust your movement speed.",
    Value = {
        Min = 16,
        Max = 200,
        Default = 16
    },
    Step = 1,
    Callback = function(Value)
        getgenv().WalkSpeedValue = Value
    end
})

SettingTab:Toggle({
    Title = "Enable WalkSpeed",
    Value = false,
    Callback = function(Value)
        getgenv().EnableWalkSpeed = Value

        if Value then
            StartWalkSpeedLoop()
        end
    end
})
